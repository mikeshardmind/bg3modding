// minus concentration, bonus action.
// fixes some upcasting issues

new entry "Projectile_EnsnaringStrike_Container"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_EnsnaringStrike_Container"
data "SpellFlags" "HasVerbalComponent;IsSpell;HasHighGroundRangeExtension;RangeIgnoreVerticalThreshold;IsHarmful;IsLinkedSpellContainer"

new entry "Projectile_EnsnaringStrike"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_EnsnaringStrike"
data "HitCosts" "SpellSlotsGroup:1:1:1"
data "SpellFlags" "HasVerbalComponent;IsSpell;HasHighGroundRangeExtension;RangeIgnoreVerticalThreshold;IsHarmful"

new entry "Projectile_EnsnaringStrike_2"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_EnsnaringStrike_2"
data "HitCosts" "SpellSlotsGroup:1:1:2"

new entry "Projectile_EnsnaringStrike_3"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_EnsnaringStrike_3"
data "SpellSuccess" "IF(not SavingThrow(Ability.Strength, SourceSpellDC(),AdvantageOnRestrained(),DisadvantageOnRestrained())):ApplyStatus(ENSNARING_STRIKE_3,100,10);DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType); ExecuteWeaponFunctors(MainHand)"
data "HitCosts" "SpellSlotsGroup:1:1:3"

new entry "Projectile_EnsnaringStrike_4"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_EnsnaringStrike_4"
data "SpellFail" "IF(HasStatus('YSRSLIDFWWADNIWHWIHLY')):SpawnExtraProjectiles(Projectile_EnsnaringStrike_4);ApplyStatus(YSRSLIDFWWADNIWHWIHLY_YWNK,100,1)"
data "ExtraProjectileTargetConditions" "Character() and not Ally()"
data "UseCosts" "ActionPoint:1"
data "HitCosts" "SpellSlotsGroup:1:1:4"

new entry "Projectile_EnsnaringStrike_5"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_EnsnaringStrike_5"
data "SpellFail" "IF(HasStatus('YSRSLIDFWWADNIWHWIHLY')):SpawnExtraProjectiles(Projectile_EnsnaringStrike_5);ApplyStatus(YSRSLIDFWWADNIWHWIHLY_YWNK,100,1)"
data "ExtraProjectileTargetConditions" "Character() and not Ally()"
data "HitCosts" "SpellSlotsGroup:1:1:5"

new entry "Projectile_EnsnaringStrike_6"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_EnsnaringStrike_6"
data "SpellFail" "IF(HasStatus('YSRSLIDFWWADNIWHWIHLY')):SpawnExtraProjectiles(Projectile_EnsnaringStrike_6);ApplyStatus(YSRSLIDFWWADNIWHWIHLY_YWNK,100,1)"
data "ExtraProjectileTargetConditions" "Character() and not Ally()"
data "HitCosts" "SpellSlotsGroup:1:1:6"

new entry "Target_EnsnaringStrike"
type "SpellData"
data "SpellType" "Target"
using "Target_EnsnaringStrike"
data "SpellSuccess" "IF(not SavingThrow(Ability.Strength, ManeuverSaveDC()+2,AdvantageOnRestrained(),DisadvantageOnRestrained())):ApplyStatus(ENSNARING_STRIKE,100,3);DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType); ExecuteWeaponFunctors(MainHand)"
data "TooltipStatusApply" "ApplyStatus(ENSNARING_STRIKE,100,3)"
data "HitCosts" "SpellSlotsGroup:1:1:1"
data "SpellFlags" "HasVerbalComponent;IsSpell;IsMelee;IsHarmful"

new entry "Target_EnsnaringStrike_2"
type "SpellData"
data "SpellType" "Target"
using "Target_EnsnaringStrike_2"
data "SpellSuccess" "IF(not SavingThrow(Ability.Strength, ManeuverSaveDC()+2,AdvantageOnRestrained(),DisadvantageOnRestrained())):ApplyStatus(ENSNARING_STRIKE_2,100,3);DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType); ExecuteWeaponFunctors(MainHand)"
data "TooltipStatusApply" "ApplyStatus(ENSNARING_STRIKE_2,100,3)"
data "HitCosts" "SpellSlotsGroup:1:1:2"

new entry "Target_EnsnaringStrike_3"
type "SpellData"
data "SpellType" "Target"
using "Target_EnsnaringStrike_3"
data "SpellSuccess" "IF(not SavingThrow(Ability.Strength, ManeuverSaveDC()+2,AdvantageOnRestrained(),DisadvantageOnRestrained())):ApplyStatus(ENSNARING_STRIKE_3,100,3);DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType); ExecuteWeaponFunctors(MainHand)"
data "TooltipStatusApply" "ApplyStatus(ENSNARING_STRIKE_3,100,3)"
data "HitCosts" "SpellSlotsGroup:1:1:3"

new entry "Target_EnsnaringStrike_4"
type "SpellData"
data "SpellType" "Target"
using "Target_EnsnaringStrike_4"
data "SpellSuccess" "IF(not SavingThrow(Ability.Strength, ManeuverSaveDC()+2,AdvantageOnRestrained(),DisadvantageOnRestrained())):ApplyStatus(ENSNARING_STRIKE_4,100,3);DealDamage(MainMeleeWeapon, MainMeleeWeaponDamageType); ExecuteWeaponFunctors(MainHand)"
data "TooltipStatusApply" "ApplyStatus(ENSNARING_STRIKE_4,100,3)"
data "HitCosts" "SpellSlotsGroup:1:1:4"

new entry "Target_EnsnaringStrike_5"
type "SpellData"
data "SpellType" "Target"
using "Target_EnsnaringStrike_5"
data "SpellSuccess" "IF(not SavingThrow(Ability.Strength, ManeuverSaveDC()+2,AdvantageOnRestrained(),DisadvantageOnRestrained())):ApplyStatus(ENSNARING_STRIKE_5,100,3);DealDamage(MainMeleeWeapon,MainMeleeWeaponDamageType);ExecuteWeaponFunctors(MainHand)"
data "TooltipStatusApply" "ApplyStatus(ENSNARING_STRIKE_5,100,3)"
data "HitCosts" "SpellSlotsGroup:1:1:5"

new entry "Target_EnsnaringStrike_6"
type "SpellData"
data "SpellType" "Target"
using "Target_EnsnaringStrike_6"
data "SpellSuccess" "IF(not SavingThrow(Ability.Strength, ManeuverSaveDC()+2,AdvantageOnRestrained(),DisadvantageOnRestrained())):ApplyStatus(ENSNARING_STRIKE_6,100,3);DealDamage(MainMeleeWeapon,MainMeleeWeaponDamageType);ExecuteWeaponFunctors(MainHand)"
data "TooltipStatusApply" "ApplyStatus(ENSNARING_STRIKE_6,100,3)"
data "HitCosts" "SpellSlotsGroup:1:1:6"

// lv 7, 8, 9 upcasting via expansion
// here for completion, but if you do upcast this to 7, 8 or 9....
// even to 4 is questionable

new entry "Target_EnsnaringStrike_7"
type "SpellData"
data "SpellType" "Target"
using "Target_EnsnaringStrike_7"
data "HitCosts" "SpellSlotsGroup:1:1:7"

new entry "Target_EnsnaringStrike_8"
type "SpellData"
data "SpellType" "Target"
using "Target_EnsnaringStrike_8"
data "HitCosts" "SpellSlotsGroup:1:1:8"

new entry "Target_EnsnaringStrike_9"
type "SpellData"
data "SpellType" "Target"
using "Target_EnsnaringStrike_9"
data "HitCosts" "SpellSlotsGroup:1:1:9"


new entry "Projectile_EnsnaringStrike_7"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_EnsnaringStrike_7"
data "SpellFail" "IF(HasStatus('YSRSLIDFWWADNIWHWIHLY')):SpawnExtraProjectiles(Projectile_EnsnaringStrike_7);ApplyStatus(YSRSLIDFWWADNIWHWIHLY_YWNK,100,1)"
data "HitCosts" "SpellSlotsGroup:1:1:7"

new entry "Projectile_EnsnaringStrike_8"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_EnsnaringStrike_8"
data "SpellFail" "IF(HasStatus('YSRSLIDFWWADNIWHWIHLY')):SpawnExtraProjectiles(Projectile_EnsnaringStrike_8);ApplyStatus(YSRSLIDFWWADNIWHWIHLY_YWNK,100,1)"
data "HitCosts" "SpellSlotsGroup:1:1:8"

new entry "Projectile_EnsnaringStrike_9"
type "SpellData"
data "SpellType" "Projectile"
using "Projectile_EnsnaringStrike_9"
data "SpellFail" "IF(HasStatus('YSRSLIDFWWADNIWHWIHLY')):SpawnExtraProjectiles(Projectile_EnsnaringStrike_9);ApplyStatus(YSRSLIDFWWADNIWHWIHLY_YWNK,100,1)"
data "HitCosts" "SpellSlotsGroup:1:1:9"