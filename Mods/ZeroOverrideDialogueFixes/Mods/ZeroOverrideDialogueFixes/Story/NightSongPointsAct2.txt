Version 1
SubGoalCombiner SGC_AND

INITSECTION

DB_mikeshardmind_ZODF_Nightsong(0);

KBSECTION

// Rather than patch the dialogue file with an override
// We're going to hit the "or" condition, rather than
// "and" when in the faulty "and" condition

IF
EnteredTrigger((CHARACTER)S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, (TRIGGER)S_SHA_NightsongPrison_SUB_0a302268-dd92-4462-99e5-ca7491815ec0)
AND
DB_GlobalFlag((FLAG)ORI_Shadowheart_State_NightsongPoint_HasEnoughPoints_82893505-534a-461a-8dd5-0f4677dad6ce)
AND
DB_GlobalCounter("ORI_Shadowheart_NightsongPoints", _Value)
AND
DB_Avatars(_Player)
AND
GetApprovalRating((CHARACTER)S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, _Player, _Approval)
AND
_Approval >= 20
AND
_Approval < 40
THEN
DB_GlobalCounter("ORI_Shadowheart_NightsongPoints", 0);
PROC_GlobalClearFlagAndCache((FLAG)ORI_Shadowheart_State_NightsongPoint_HasEnoughPoints_82893505-534a-461a-8dd5-0f4677dad6ce);
DB_mikeshardmind_ZODF_Nightsong(_Value);


// And restore the values once we're out, they come up again later, and are correctly handled in act 3

IF
LeftTrigger((CHARACTER)S_Player_ShadowHeart_3ed74f06-3c60-42dc-83f6-f034cb47c679, (TRIGGER)S_SHA_NightsongPrison_SUB_0a302268-dd92-4462-99e5-ca7491815ec0)
AND
DB_mikeshardmind_ZODF_Nightsong(_Value)
AND
_Value > 0
THEN
DB_GlobalCounter("ORI_Shadowheart_NightsongPoints", _Value);
PROC_GlobalSetFlagAndCache((FLAG)ORI_Shadowheart_State_NightsongPoint_HasEnoughPoints_82893505-534a-461a-8dd5-0f4677dad6ce);

EXITSECTION

ENDEXITSECTION